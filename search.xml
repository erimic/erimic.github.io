<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[Debian下Shadowsocks安装及优化]]></title>
      <url>http://erimic.github.io/2017/03/15/shadownsocks/</url>
      <content type="html"><![CDATA[<h1 id="Debian下Shadowsocks安装及优化"><a href="#Debian下Shadowsocks安装及优化" class="headerlink" title="Debian下Shadowsocks安装及优化"></a>Debian下Shadowsocks安装及优化</h1><p>本文主要针对Xen架构vps环境搭建Shadowsockes服务器。并启用Google BBR优化内核中的拥塞算法，优化TCP。</p>
<blockquote>
<p>一键安装脚本参照的是<a href="https://teddysun.com/358.html" target="_blank" rel="external">秋水逸冰</a> 的博文，出于低内存低CPU考虑，使用shadowsocks-libev</p>
</blockquote>
<h3 id="Shadowsocks安装"><a href="#Shadowsocks安装" class="headerlink" title="Shadowsocks安装"></a><strong>Shadowsocks安装</strong></h3><p><strong>安装方法</strong></p>
<p>使用root用户登录</p>
<pre><code class="shell">wget --no-check-certificate https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks-libev-debian.sh
chmod +x shadowsocks-libev-debian.sh
./shadowsocks-libev-debian.sh 2&gt;&amp;1 | tee shadowsocks-libev-debian.log
</code></pre>
<p><strong>配置文件路径</strong></p>
<p>/etc/shadowsocks-libev/config.json</p>
<p>内容如下</p>
<pre><code class="shell">{
    &quot;server&quot;:[&quot;[::0]&quot;,&quot;0.0.0.0&quot;],
    &quot;server_port&quot;:8989,
    &quot;local_address&quot;:&quot;127.0.0.1&quot;,
    &quot;local_port&quot;:1080,
    &quot;password&quot;:&quot;password&quot;,
    &quot;timeout&quot;:600,
    &quot;method&quot;:&quot;aes-256-cfb&quot;
}
</code></pre>
<p>各字段含义</p>
<p>server：服务器 IP (IPv4/IPv6)，注意这也将是服务端监听的 IP 地址</p>
<p> server_port：监听的服务器端口</p>
<p> local_address：本地监听的 IP 地址</p>
<p> local_port：本地端端口</p>
<p> password：用来加密的密码</p>
<p> timeout：超时时间（秒）</p>
<p> method：加密方法，可选择 “bf-cfb”, “aes-256-cfb”, “des-cfb”, “rc4”, 等等。默认是一种不安全的加密，推荐用 “aes-256-cfb”</p>
<p><strong>卸载方法</strong></p>
<pre><code class="shell">./shadowsocks-libev-debian.sh uninstall
</code></pre>
<p><strong>常用命令</strong></p>
<p>启动:</p>
<pre><code class="shell">/etc/init.d/shadowsocks start
</code></pre>
<p>停止:</p>
<pre><code class="shell">/etc/init.d/shadowsocks stop
</code></pre>
<p>重启:</p>
<pre><code class="shell">/etc/init.d/shadowsocks restart
</code></pre>
<p>查看状态:</p>
<pre><code class="shell">/etc/init.d/shadowsocks status
</code></pre>
<h3 id="Shadowsocks客户端配置"><a href="#Shadowsocks客户端配置" class="headerlink" title="Shadowsocks客户端配置"></a>Shadowsocks客户端配置</h3><p>Windows下客户端较多，我们采用GitHub上开源的<a href="https://github.com/shadowsocks/shadowsocks-windows" target="_blank" rel="external"><strong>shadowsocks-windows</strong></a>下载地址:</p>
<p><a href="https://github.com/shadowsocks/shadowsocks-windows/releases" target="_blank" rel="external">https://github.com/shadowsocks/shadowsocks-windows/releases</a></p>
<p>解压至任意目录下，双击Shadowsocks.exe运行程序，填入各参数</p>
<p><img src="1489496116859.png" alt="1489496116859"></p>
<h3 id="一键安装最新内核并开启BBR"><a href="#一键安装最新内核并开启BBR" class="headerlink" title="一键安装最新内核并开启BBR"></a>一键安装最新内核并开启BBR</h3><blockquote>
<p>参考<a href="https://teddysun.com/358.html" target="_blank" rel="external">秋水逸冰</a> 的另一博文<a href="https://teddysun.com/489.html" target="_blank" rel="external">一键安装最新内核并开启BBR</a></p>
</blockquote>
<p>使用root用户登录</p>
<pre><code class="shell">wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.sh
chmod +x bbr.sh
./bbr.sh
</code></pre>
<p>安装后重启VPS验证是否启用BBR</p>
<pre><code class="shell">uname -r
</code></pre>
<p>4.10.1-041001-generic</p>
<pre><code class="shell">sysctl net.ipv4.tcp_available_congestion_control
</code></pre>
<p>net.ipv4.tcp_available_congestion_control = bbr cubic reno</p>
<pre><code class="shell">sysctl net.ipv4.tcp_congestion_control
</code></pre>
<p>net.ipv4.tcp_congestion_control = bbr</p>
<pre><code class="shell">sysctl net.core.default_qdisc
</code></pre>
<p>net.core.default_qdisc = fq</p>
<pre><code class="shell">lsmod | grep bbr
</code></pre>
<p>返回有值表明已启用BBR算法</p>
<h3 id="系统优化"><a href="#系统优化" class="headerlink" title="系统优化"></a>系统优化</h3><p><strong>increase the maximum number of open file descriptors</strong></p>
<p>编辑limits.conf</p>
<p><code>vi /etc/security/limits.conf</code></p>
<p>添加一下两行</p>
<pre><code class="shell">* soft nofile 51200
* hard nofile 51200
</code></pre>
<pre><code class="shell">ulimit -n 51200
</code></pre>
<p>重启shadowsocks</p>
<p><strong>Tune the kernel parameters</strong></p>
<p>编辑sysctl.conf</p>
<p><code>vi /etc/sysctl.conf</code></p>
<pre><code>fs.file-max = 51200

net.core.rmem_max = 67108864
net.core.wmem_max = 67108864
net.core.netdev_max_backlog = 250000
net.core.somaxconn = 4096

net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_tw_recycle = 0
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_keepalive_time = 1200
net.ipv4.ip_local_port_range = 10000 65000
net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_max_tw_buckets = 5000
net.ipv4.tcp_fastopen = 3
net.ipv4.tcp_mem = 25600 51200 102400
net.ipv4.tcp_rmem = 4096 87380 67108864
net.ipv4.tcp_wmem = 4096 65536 67108864
net.ipv4.tcp_mtu_probing = 1
</code></pre>]]></content>
      
        
    </entry>
    
  
  
</search>
